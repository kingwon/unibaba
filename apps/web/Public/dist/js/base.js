!function(a){function b(b){function c(b,c){var d=a.widget[c];d&&new d(b)}b.find("[widget]").each(function(){var a=this.getAttribute("widget").replace(/-/g,"_");if(-1==a.indexOf(" "))c(this,a);else{a=a.split(" ");for(var b=0,d=a.length;d>b;b++)c(this,a[b])}})}a.widget={},a.util={},$(function(){b($("body"))}),a.util.parse=function(a){b(a)},a.debug=function(a){console.log(a)}}(window),function(){var a=123456789;window.util.modal=function(b){function c(){var a="";return a+='<div class="modal fade">',a+=' <div class="modal-dialog">',a+='  <div class="modal-content">',b.title&&(a+='   <div class="modal-header">',a+='    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',a+='    <h4 class="modal-title">'+b.title+"</h4>",a+="   </div>"),a+='   <div class="modal-body"><p>'+b.body+"</p></div>",b.async||(a+='   <div class="modal-footer">',a+='    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>',a+="   </div>"),a+="  </div>",a+=" </div>",a+="</div>"}b.id||(b.id=a++);var d=$(".util-modal-"+b.id);if(0==d.length&&(d=$(c()),d.addClass("util-modal-"+b.id),$("body").append(d)),d.modal("show"),b.async){var e=!0;d.on("hide.bs.modal",function(){return!e}),b.async(function(){e=!1,d.modal("hide")})}}}(),function(){window.util.parsley={},window.util.parsley.remove=function(a,b){try{for(var c=0,d=b.length;d>c;c++)a.parsley("removeItem","#"+b[c])}catch(e){}},window.util.parsley.add=function(a,b){try{for(var c=0,d=b.length;d>c;c++)a.parsley("addItem","#"+b[c])}catch(e){}}}(),function(){var a=function(a){this.init(a)};window.widget.ajax_save=a,a.prototype={init:function(a){function b(){var a="";return a+='<div class="modal fade">',a+=' <div class="modal-dialog">',a+='  <div class="modal-content">',a+='   <div class="modal-body">',a+="    <p>"+d+"</p>",a+="   </div>",a+="  </div>",a+=" </div>",a+="</div>"}var c=$(a),d=c.attr("data-ajax-save-text");d||(d="保存中...");var e=c.attr("data-ajax-save-oncompleted");e&&window[e]&&(e=window[e]);var f,g=c.attr("data-ajax-save-onstart"),h=!1;c.on("submit",function(){if(window[g]&&0==window[g]())return!1;var a=c.data("validation");if(!a||a.isValid())return h=!0,f||(f=$(b()),$("body").append(f),f.on("hide.bs.modal",function(){return!h})),$.post(c.attr("action"),c.serialize(),function(a){h=!1,"string"==typeof a&&(a=JSON.parse(a)),f.modal("hide"),e&&e({json:a})}),f.modal("show"),!1})}}}(),function(){var a=function(a){this.init(a)};window.widget.ajax_upload=a,a.prototype={mOption:null,init:function(a){var b=$(a);b.data("ajax-upload",this);var c,d=this.mOption=window[b.attr("data-ajax-upload-option")]();b.ajaxfileupload({action:d.url,valid_extensions:d.fileType,onComplete:function(a){0==a.status?d.onError&&d.onError():(c(),d.onFinish&&d.onFinish({json:a}))},onStart:function(){window.util.modal({id:"ajax-upload",body:"处理中...",async:function(a){c=a}})},onCancel:function(){}})},set:function(a){$.extend(this.mOption,a)},getOption:function(){return this.mOption}}}(),function(a){a.fn.ajaxfileupload=function(b){var c={params:{},action:"",onStart:function(){console.log("starting upload"),console.log(this)},onComplete:function(a){console.log("got response: "),console.log(a),console.log(this)},onCancel:function(){console.log("cancelling: "),console.log(this)},validate_extensions:!0,valid_extensions:["gif","png","jpg","jpeg"],submit_button:null},d=!1;return b&&a.extend(c,b),this.each(function(){var b=a(this);if(b.data("ajaxUploader-setup")!==!0){b.change(function(){d=!1,null==c.submit_button&&e()}),null==c.submit_button||c.submit_button.click(function(){d||e()});var e=function(){if(""==b.val())return c.onCancel.apply(b,[c.params]);var e=b.val().split(".").pop().toLowerCase();if(!0===c.validate_extensions&&-1==a.inArray(e,c.valid_extensions))c.onComplete.apply(b,[{status:!1,message:"The select file type is invalid. File must be "+c.valid_extensions.join(", ")+"."},c.params]);else{d=!0,g(b);var f=c.onStart.apply(b,[c.params]);f!==!1&&b.parent("form").submit(function(a){a.stopPropagation()}).submit()}};b.data("ajaxUploader-setup",!0);var f=function(a,b){var e,f=a.contentWindow.document.body.innerHTML;try{e=JSON.parse(f)}catch(g){e=f}b.siblings().remove(),b.unwrap(),d=!1,c.onComplete.apply(b,[e,c.params])},g=function(b){var d="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1e3);a("body").after('<iframe width="0" height="0" style="display:none;" name="'+d+'" id="'+d+'"/>'),a("#"+d).load(function(){f(this,b)}),b.wrap(function(){return'<form action="'+c.action+'" method="POST" enctype="multipart/form-data" target="'+d+'" />'}).before(function(){var a,b="";for(a in c.params){var d=c.params[a];"function"==typeof d&&(d=d()),b+='<input type="hidden" name="'+a+'" value="'+d+'" />'}return b})}}})}}(jQuery),function(){var a=function(a){this.init(a)};window.widget.auto_complete_editable=a,a.prototype={init:function(a){function b(){var a="";return a+='<div class="item">{#name#}',a+='<button class="btn btn-danger btn-xs delete" vid="{#id#}">X</button>',a+='<input type="hidden" name="'+(d.inputName||"arr")+'[]" value="{#id#}"></div>'}var c=$(a);c.css("position","relative"),c.addClass("auto-complete-editable");var d=window[c.attr("data-auto-complete-editable-option")](),e=c.find('[role="list"]'),f=[],g=b();d.onSelect=function(a){for(var b=0,c=f.length;c>b;b++)if(f[b]==a.id)return alert("已经添加"),h.get$input().val(""),void 0;f.push(a.id),h.get$input().val(""),debug(a.name),e.append(g.replace(/{#name#}/g,a.name).replace(/{#id#}/g,a.id))};var h=new window.widget.auto_complete(a,d);if(h.get$input().on("keydown",function(a){return 13==a.keyCode?!1:void 0}),d.default)for(var i=0,j=d.default.length;j>i;i++)f.push(d.default[i].id),e.append(g.replace(/{#name#}/g,d.default[i].name).replace(/{#id#}/g,d.default[i].id));e.on("click",".delete",function(){var a=confirm("确定删除吗");if(!a)return!1;var b=$(this),c=b.attr("vid");$(this).parent().remove();for(var d=0,e=f.length;e>d;d++)f[d]==c&&(f[d]=void 0);return!1})}}}(),function(){var a=function(a,b){this.init(a,b)};window.widget.auto_complete_simple=a,a.prototype={$input:null,mOption:null,init:function(a,b){function c(a){if(""==a)return g.html(""),d.removeClass("open"),void 0;var c=b.url;c+=-1==c.indexOf("?")?"?":"&",c+=f.attr("name")+"="+a,$.getJSON(c,function(a){if(!a.error){a=a.data;for(var b="",c=0,e=a.length;e>c;c++)b+='<li><a href="#">'+a[c]+"</a></li>";g.html(b),d.addClass("open")}})}var d=$(a);d.css("position","relative"),!b&&(b=window[d.attr("data-auto-complete-option")]()),this.mOption=b;var e,f=this.$input=d.find('input[type="text"]'),g=d.find(".dropdown-menu"),h="";$(document).on("click",function(){d.removeClass("open")}),f.on("click",function(){e=setInterval(function(){var a=f.val().trim();a!=h&&(h=a,c(h))},300)}),g.on("click","a",function(){var a=$(this);h=a.text(),f.val(h),g.html(""),d.removeClass("open"),b.onSelect&&b.onSelect({id:a.attr("vid"),name:a.text()})})},getOption:function(){return this.mOption},get$input:function(){return this.$input}}}(),function(){var a=function(a,b){this.init(a,b)};window.widget.auto_complete=a,a.prototype={$input:null,$hidden:null,mOption:null,data:[],init:function(a,b){function c(a){if(""==a)return g.html(""),e.removeClass("open"),void 0;var c=b.url;c+=-1==c.indexOf("?")?"?":"&",c+=f.attr("name")+"="+a,$.getJSON(c,function(a){if(!a.error){if(a=a.data,d.data=a,b.entity)for(var c=0,f=a.length;f>c;c++)a[c].id=a[c][b.entity.id],a[c].name=a[c][b.entity.name];for(var h="",i=b.item,c=0,f=a.length;f>c;c++)h+=i?$.isFunction(i)?i(a[c]):_.template(i,a[c]):'<li><a href="#" i="'+c+'" vid="'+a[c].id+'">'+a[c].name+"</a></li>";g.html(h),e.addClass("open")}})}var d=this,e=$(a);e.css("position","relative"),!b&&(b=window[e.attr("data-auto-complete-option")]()),this.mOption=b;var f=this.$input=e.find('input[type="text"]'),g=e.find(".dropdown-menu"),h=this.$hidden=e.find('input[type="hidden"]');h.length>0&&(h=this.$hidden=h.eq(0));var i,j="";$(document).on("click",function(){e.removeClass("open")}),f.on("click",function(){i=setInterval(function(){var a=f.val().trim();a!=j&&(j=a,c(j))},300)}),g.on("click","a",function(){var a=$(this);return j=a.text(),f.val(j),h&&h.val(a.attr("vid")),e.removeClass("open"),b.onSelect&&b.onSelect(d.data[$(this).attr("i")]),g.html(""),!1})},getOption:function(){return this.mOption},get$input:function(){return this.$input},get$hidden:function(){return this.$hidden}}}(),function(){var a=function(a){this.init(a)};window.widget.check_all_auth=a,a.prototype={init:function(a){var b=$(a),c=$(b.attr("data-check-all-target"));b.on("change",function(){c.prop("checked",b.prop("checked")),c.trigger("change")}),c.on("change",function(){var a=!1;c.each(function(){return $(this).prop("checked")?(a=!0,void 0):void 0}),b.prop("checked",a)})}}}(),function(){var a=function(a){this.init(a)};window.widget.check_all=a,a.prototype={init:function(a){var b=$(a),c=$(b.attr("data-check-all-target"));b.on("change",function(){c.prop("checked",b.prop("checked")),c.trigger("change")}),c.on("change",function(){var a=b.prop("checked"),d=$(this).prop("checked");if(a&&!d)b.prop("checked",!1);else if(!a&&d){var e=!0;c.each(function(){return $(this).prop("checked")?void 0:(e=!1,void 0)}),e&&b.prop("checked",!0)}})}}}(),function(){var a=function(a){this.init(a)};a.prototype={init:function(a){var b=$(a);b.on("click",function(){return confirm("确定要"+b.text()+"吗？")})}},window.widget.confirm=a}(),function(){var a=function(a){this.init(a)};window.widget.datepicker=a,a.prototype={init:function(a){var b=$(a),c=!1;b.attr("data-error-container")&&(c=!0);var d={language:"zh-CN",format:"yyyy-mm-dd"};b.attr("data-date-start")&&(d.startDate=b.attr("data-date-start")),b.datepicker(d).on("changeDate",function(){b.datepicker("hide")}).on("hide",function(){c&&b.parsley("validate")})}}}(),function(){var a=function(a){this.init(a)};window.widget.disabled=a,a.prototype={init:function(a){var b=$(a),c=b.attr("data-disabled-selector");b.find(c).prop("disabled",!0)}}}(),function(){var a=function(a){this.init(a)};window.widget.editor=a,a.prototype={init:function(a){debug(123);var b=$(a);b.attr("id","myEditor");{var c=b.data("params")||{};UE.getEditor("myEditor",{imageUrl:c.imageUrl||"",imagePath:"",toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","insertimage","|","horizontal","date","time","spechars","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","print","preview","searchreplace","help"]]})}}}}(),function(){var a=function(a){this.init(a)};window.widget.input_count=a,a.prototype={init:function(a){function b(){var a=c.val().replace(/[^\x00-\xff]/g,"**").length;a=parseInt(a/2);var b={};b.count=a,e&&d.html(e(b))}var c=$(a),d=$(c.attr("data-input-count-target")),e=c.attr("data-input-count-on-change");e&&(e=window[e]),b(),c.on("keyup",function(){b()})}}}(),function(){var a=function(a){this.init(a)};window.widget.linked_select_otm=a,a.prototype={init:function(a){function b(a){if(""!=a){for(var b=0,d=f.length;d>b;b++)$(f[b]).html('<option value="">加载中...</option>');var g=e;g+=-1==g.indexOf("?")?"?":"&",g+=c.attr("name")+"="+c.val();for(var b=0;0>b;b++)g+="&"+$(f[b]).attr("name")+"="+$(f[b]).val();$.getJSON(g,function(a){if(!a.error){a=a.data;for(var b=0,c=a.length;c>b;b++){for(var d="",e=0,g=a[b].length;g>e;e++)d+='<option value="'+a[b][e].id+'">'+a[b][e].name+"</option>";$(f[b]).html('<option value="">请选择</option>'+d)}}})}else for(var b=0,d=f.length;d>b;b++)$(f[b]).html('<option value="">请选择</option>')}var c=$(a),d=window[c.attr("data-linked-select-option")](),e=d.url,f=d.link;c.on("change",function(){b(c.val())})}}}(),function(){var a=function(a){this.init(a)};window.widget.linked_select=a,a.prototype={init:function(a){function b(a,b){if(""!=b){for(var d=a,e=g.length;e>d;d++)$(g[d]).html('<option value="">加载中...</option>');var h=f;h+=-1==h.indexOf("?")?"?":"&",h+=c.attr("name")+"="+c.val();for(var d=0;a>d;d++)h+="&"+$(g[d]).attr("name")+"="+$(g[d]).val();$.getJSON(h,function(b){if(!b.error){b=b.data;for(var c="",d=0,e=b.length;e>d;d++)c+='<option value="'+b[d].id+'">'+b[d].name+"</option>";for(var d=a,e=g.length;e>d;d++)d==a?$(g[d]).html('<option value="">请选择</option>'+c):$(g[d]).html('<option value="">请选择</option>')}})}else for(var d=a,e=g.length;e>d;d++)$(g[d]).html('<option value="">请选择</option>')}var c=$(a),d=window[c.attr("data-linked-select-option")](),e=d.type;if("oneToMany"==e)return new window.widget.linked_select_otm(a),void 0;var f=d.url,g=d.link;c.on("change",function(){b(0,c.val())});for(var h=0,i=g.length-1;i>h;h++){var j=$(g[h]);j.on("change",{index:h},function(a){b(a.data.index+1,$(this).val())})}}}}(),function(){var a=function(a){this.init(a)};window.widget.map_v2=a,a.prototype={init:function(a){function b(){function a(){if(f.length&&-1!=f.val().indexOf(",")){var a=f.val().split(",");g=a[0],h=a[1],i=a[2]}var b;b=h?new BMap.Point(h,g):new BMap.Point("113.939507","22.547819"),n=new BMap.Marker(b),m=new BMap.Map(k[0]),m.addControl(new BMap.NavigationControl),m.addControl(new BMap.OverviewMapControl),m.centerAndZoom(b,i),m.addOverlay(n),m.addEventListener("click",function(a){n.setPosition(a.point)}),n.enableDragging(),m.enableScrollWheelZoom()}if("undefined"==typeof BMap)throw new Error("亲，得先加载百度地图API");a()}function c(){var a="";return a+='<div class="map modal fade">',a+=' <div class="modal-dialog" style="width: 800px;">',a+='  <div class="modal-content">',a+='   <div class="modal-header">',a+='    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',a+='    <h4 class="modal-title">地图标注</h4>',a+="   </div>",a+='   <div class="modal-body" style="height: 400px;"></div>',a+='   <div class="modal-footer">',a+='    <button type="button" class="btn btn-primary map-confirm">确定</button>',a+='    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>',a+="   </div>",a+="  </div>",a+=" </div>",a+="</div>"}var d,e=$(a),f=$(e.attr("data-map-input")),g=e.attr("data-map-lat"),h=e.attr("data-map-lng"),i=e.attr("data-map-zoom");i||(i=13);var j=e.attr("data-map-on-completed");j&&(j=window[j]);var k,l,m,n;f&&g&&f.val(g+","+h+","+i),e.on("click",function(){return g=e.attr("data-map-lat"),h=e.attr("data-map-lng"),d||(d=$(c()),$("body").append(d),k=d.find(".modal-body"),l=d.find(".map-confirm"),l.on("click",function(){d.modal("hide");var a=n.getPosition(),b=m.getZoom(),c=a.lat,e=a.lng;g=c,h=e,i=b,f&&f.val(c+","+e+","+b),j&&j({lat:c,lng:e,zoom:b})})),d.modal("show"),setTimeout(function(){b()},500),!1})}}}(),function(){var a=function(a){this.init(a)};window.widget.pagination=a,a.prototype={init:function(a){function b(){var a=e,b="",d=f-2;1>d&&(d=1);var g=f+2;g>a&&(g=a);for(var h='<li><a href="javascript:;" value="{#pageValue#}">{#page#}</a></li>',i='<li class="disabled"><span>{#page#}</span></li>',j='<li class="active"><span>{#page#}</span></li>',k="<li><span>...</span></li>",l=d;g>=l;l++)b+=l==f?j.replace("{#page#}",l):h.replace("{#page#}",l).replace("{#pageValue#}",l);d>2&&(b=k+b),1!=d&&(b=h.replace("{#page#}",1).replace("{#pageValue#}",1)+b),b=1==f?i.replace("{#page#}","上一页")+b:h.replace("{#page#}","上一页").replace("{#pageValue#}",0)+b,a-1>g&&(b+=k),g!=a&&(b+=h.replace("{#page#}",a).replace("{#pageValue#}",a)),b+=f==a?i.replace("{#page#}","下一页"):h.replace("{#page#}","下一页").replace("{#pageValue#}",-1),b='<ul class="pagination">'+b+"</ul>",c.html(b)}var c=$(a),d=c.attr("data-pagination-onchange"),e=c.attr("data-pagination-total"),f=parseInt(c.attr("data-pagination-current")),g=0,h=-1;b(),c.on("click","a",function(){var a=parseInt($(this).attr("value"));switch(a){case g:f--;break;case h:f++;break;default:f=a}b(),window[d]&&window[d]({page:f})})}}}(),function(){var a=function(a){this.init(a)};window.widget.switch=a,a.prototype={init:function(a){function b(a){for(var b=0,c=e.length;c>b;b++)b==a?($(e[b]).show(),g&&$(e[b]).find("input, select, textarea").prop("disabled",!1)):($(e[b]).hide(),g&&$(e[b]).find("input, select, textarea").prop("disabled",!0))}var c=$(a),d=window[c.attr("data-switch-option")](),e=d.target,f=d.trigger,g=d.isForm;if(c.is("select"))c.on("change",function(){var a=c.find("option:selected").html();c.find("option").each(function(c){a==$(this).html()&&(d.onSwitch&&d.onSwitch({index:c}),b(c))})});else for(var h=0,i=f.length;i>h;h++)c.find(f[h]).on("click",{index:h},function(a){d.onSwitch&&d.onSwitch({index:a.data.index}),b(a.data.index);for(var e=0,g=f.length;g>e;e++)e==a.data.index?c.find(f[e]).addClass("switch-selected"):c.find(f[e]).removeClass("switch-selected")});if(g)if(c.is("select")){var j=c.find("option:selected").html();c.find("option").each(function(a){j==$(this).html()&&b(a)})}else for(var h=0,i=f.length;i>h;h++)c.find(f[h]).hasClass("switch-selected")&&b(h)}}}(),function(){var a=function(a){this.init(a)};window.widget.toggle_edit=a,a.prototype={$btnCancel:null,$btnEdit:null,onSaveStart:null,onSave:null,onSaveFinish:null,init:function(a){var b=this,c=$(a);c.data("toggle-edit",this);var d=this.$btnEdit=c.find(".sec-btn-edit"),e=c.find(".sec-btn-save"),f=this.$btnCancel=c.find(".sec-btn-cancel"),g=c.find(".sec-item"),h=!1;this.onSave=window[c.attr("data-toggle-edit-onsave")],d.on("click",function(){h=!h,d.hide(),e.show(),f.show(),g.each(function(){var a=$(this);a.find(".sec-text").hide(),a.find(".sec-edit").show();var b=a.find(".sec-text-value"),c=a.find(".sec-edit-value");if(c.removeClass("invalid"),c.is('[type="text"]'))c.val(b.text());else if(c.is("select")){var d=b.attr("value");c.find("option").each(function(){var a=$(this);a.attr("value")==d&&c.val(a.val())})}})}),e.on("click",function(){if(b.onSaveStart&&0==b.onSaveStart())return!1;var a=!0;return c.find(".validate").each(function(){var b=$(this).parsley("validate");b||(a=!1)}),a?(window.util.modal({id:"toggle-edit-save",body:"保存中...",async:function(a){function i(){h=!h,d.show(),e.hide(),f.hide(),g.each(function(){var a=$(this);a.find(".sec-text").show(),a.find(".sec-edit").hide();var b=a.find(".sec-text-value"),c=a.find(".sec-edit-value");c.is('[type="text"]')?b.text(c.val()):c.is("select")&&(b.text(c.find("option:selected").text()),b.attr("value",c.val()))}),a()}function j(){var a={};return c.find("input, select").each(function(){var b=$(this);a[b.attr("name")]=b.val()}),a}if(b.onSave){var k={};k.params=j(),k.$dom=c,k.onFinish=i,k.onError=a,b.onSave(k)}else a()}}),void 0):!1}),f.on("click",function(){h=!h,d.show(),e.hide(),f.hide(),g.each(function(){var a=$(this);a.find(".sec-text").show(),a.find(".sec-edit").hide()})})},set:function(a){a.onSaveStart&&(this.onSaveStart=a.onSaveStart),a.onSave&&(this.onSave=a.onSave),a.onSaveFinish&&(this.onSaveFinish=a.onSaveFinish)},onClickCancel:function(){this.$btnCancel.trigger("click")},getBtnEdit:function(){return this.$btnEdit},getBtnCancel:function(){return this.$btnCancel}}}(),function(){var a=function(a){this.init(a)};window.widget.toggle=a,a.prototype={init:function(a){function b(){d.is(":visible")?c.addClass("toggle-hide").removeClass("toggle-show"):c.addClass("toggle-show").removeClass("toggle-hide")}var c=$(a),d=$(c.attr("data-toggle-target"));b(),c.on("click",function(){d.toggle(),b()})}}}(),function(){var a=function(a){this.init(a)};window.widget.tooltip=a,a.prototype={init:function(a){var b=$(a),c=b.attr("data-tooltip-title"),d=b.attr("data-tooltip-position"),e=b.attr("data-tooltip-target");e&&(c=$(e).html()),b.tooltip({html:!0,title:c,placement:d})}}}(),function(){var a=function(a){this.init(a)};window.widget.validation=a,a.prototype={$dom:null,init:function(a){var b=$(a);this.$dom=b,b.data("validation",this),b.parsley({trigger:"change blur",excluded:"input[type=file], :disabled"}),b.find("input, select, textarea").on("blur",function(){$(this).parsley("validate")})},isValid:function(){return this.$dom.parsley("isValid")},validate:function(){return this.$dom.parsley("validate")},parse:function(){this.$dom.parsley()},getDom:function(){return this.$dom}}}(),function(){var a=function(a){this.init(a)};window.widget.map=a,a.prototype={init:function(a){function b(){function a(){var a=new BMap.Point(i,h);k=new BMap.Marker(a),j=new BMap.Map(f[0]),j.addControl(new BMap.NavigationControl),j.addControl(new BMap.OverviewMapControl),j.centerAndZoom(a,13),j.addOverlay(k),j.addEventListener("click",function(a){k.setPosition(a.point)}),k.enableDragging(),j.enableScrollWheelZoom()}if("undefined"==typeof BMap)throw new Error("亲，得先加载百度地图API");a()}function c(a){a.lat&&(h=a.lat),a.lng&&(i=a.lng)}function d(){var a="";return a+='<div class="map modal fade">',a+=' <div class="modal-dialog" style="width: 800px;">',a+='  <div class="modal-content">',a+='   <div class="modal-header">',a+='    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',a+='    <h4 class="modal-title">地图标注</h4>',a+="   </div>",a+='   <div class="modal-body" style="height: 400px;"></div>',a+='   <div class="modal-footer">',a+='    <button type="button" class="btn btn-primary map-confirm">确定</button>',a+='    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>',a+="   </div>",a+="  </div>",a+=" </div>",a+="</div>"}var e,f,g,h,i,j,k,l=$(a),m=l.attr("data-map-onstart"),n=l.attr("data-map-oncompleted");l.on("click",function(){return window[m]&&window[m](c),e||(e=$(d()),$("body").append(e),f=e.find(".modal-body"),g=e.find(".map-confirm"),g.on("click",function(){e.modal("hide");var a=k.getPosition(),b=(j.getZoom(),a.lat),c=a.lng;window[n]&&window[n]({lat:b,lng:c})})),e.modal("show"),setTimeout(function(){b()},500),!1})}}}(),function(){var a=function(a){this.init(a)};window.widget.city_mgr=a,a.prototype={init:function(a){function b(a){var b={};return a.find("input").each(function(){var a=$(this);b[a.attr("name")]=a.val()}),b}function c(a,b){var c=a.data("toggle-edit");c.set({onSave:function(c){c.params.cityId=b;var d=c.onFinish;c.onFinish=function(){d(),a.find(".city-mgr-delete").show()},g(c)}})}function d(a){var b=!0;return a.find(".sec-switch").each(function(){var a=$(this),c=a.find(".sec-text-value");-1!=c.text().indexOf("启")?(b=!1,c.addClass("text-success").removeClass("text-danger")):c.addClass("text-danger").removeClass("text-success")}),b}var e=$(a),f=e.attr("data-city-mgr-onAreaSave");f&&(f=window[f]);var g=e.attr("data-city-mgr-onAreaSave");g&&(g=window[g]);var h=e.attr("data-city-mgr-onAreaDelete");h&&(h=window[h]),setTimeout(function(){e.find('.sec-children [widget="toggle-edit"]').each(function(){c($(this))}),e.find(".sec-parent").each(function(){var a=$(this),b=d(a);b&&a.find(".city-mgr-delete").show(),a.data("toggle-edit").set({onSave:function(c){var e=c.onFinish;c.onFinish=function(){e(),b=d(a),b&&a.find(".city-mgr-delete").show()},f(c)}});var c;a.find(".sec-btn-edit").on("click",function(){c=$(a.find('[widget="map-v2"]').attr("data-map-input")).val()}),a.find(".sec-btn-cancel").on("click",function(){$(a.find('[widget="map-v2"]').attr("data-map-input")).val(c)})}),e.find('.sec-parent [widget="toggle"]').on("click",function(){var a=$($(this).attr("data-toggle-target"));a.is(":visible")||a.find(".sec-btn-cancel").each(function(){var a=$(this);"none"!=a.css("display")&&a.trigger("click")})})},300),e.find(".sec-children-add-btn").on("click",function(){for(var a=$(this).attr("parentId"),b=$(this);!b.is("td");)b=b.parent();var d=b.find(".sec-children-add"),e=$("#modal-child").children().clone();d.append(e),e.wrap("<span></span>"),window.util.parse(e.parent()),e.find(".sec-btn-edit").trigger("click"),c(e,a),e.find(".sec-btn-cancel").on("click",function(){var a=!0;e.find(".sec-text-value").each(function(){return $(this).html()?(a=!1,void 0):void 0}),a&&e.remove()})}),e.on("click",".sec-btn-edit",function(){$(this).parent().find(".city-mgr-delete").hide()}),e.on("click",".sec-children .sec-btn-cancel",function(){$(this).parent().find(".city-mgr-delete").show()}),e.on("click",".sec-parent .sec-btn-cancel",function(){for(var a=$(this);!a.is("tr");)a=a.parent();var b=d(a);b&&a.find(".city-mgr-delete").show()}),e.on("click",".sec-children .city-mgr-delete",function(){var a=confirm("确定要删除吗？");if(a){for(var c=$(this);!c.is('[widget="toggle-edit"]');)c=c.parent();window.util.modal({id:"city-mgr-delete",body:"删除中...",async:function(a){var d={};d.params=b(e),d.onError=a,d.onFinish=function(){c.remove(),a()},h(d)}})}})}}}(),function(){var a=function(a){this.init(a)};window.widget.import_agent=a,a.prototype={init:function(){}}}(),function(){var a=function(a){this.init(a)};window.widget.select_person=a,a.prototype={init:function(a){function b(){var a=u;return-1==a.indexOf("?")&&(a+="?"),a+=n.serialize()}function c(){m.empty(),m.append("<h3>数据加载中...</h3>"),o.empty(),$.getJSON(b(),function(a){if(a&&!a.error){var b=a.data;a.pageTotal=a.pageTotal;for(var c=0,d=b.length;d>c;c++)b[c].id=b[c].id,b[c].name=b[c].name;e(a.pageTotal),m.empty();for(var c=0,d=b.length;d>c;c++){var f;f=s[b[c].id]?$('<button type="button" class="btn btn-info col-md-4" cid="'+b[c].id+'">'+b[c].name+"</button>"):$('<button type="button" class="btn btn-default col-md-4" cid="'+b[c].id+'">'+b[c].name+"</button>"),f.data("data",b[c]),m.append(f)}}})}function d(){l.empty();for(var a,b=0,c=t.length;c>b;b++)a=$('<button type="button" class="btn btn-primary col-md-4" cid="'+t[b].id+'">'+t[b].name+"</button>"),a.data("data",t[b]),l.append(a)}function e(a){g=a;var b="",c=f-2;1>c&&(c=1);var d=f+2;d>a&&(d=a);for(var e='<li><a href="javascript:;" value="{#pageValue#}">{#page#}</a></li>',h='<li class="disabled"><span>{#page#}</span></li>',i='<li class="active"><span>{#page#}</span></li>',j="<li><span>...</span></li>",k=c;d>=k;k++)b+=k==f?i.replace("{#page#}",k):e.replace("{#page#}",k).replace("{#pageValue#}",k);c>2&&(b=j+b),1!=c&&(b=e.replace("{#page#}",1).replace("{#pageValue#}",1)+b),b=1==f?h.replace("{#page#}","上一页")+b:e.replace("{#page#}","上一页").replace("{#pageValue#}",0)+b,a-1>d&&(b+=j),d!=a&&(b+=e.replace("{#page#}",a).replace("{#pageValue#}",a)),b+=f==a?h.replace("{#page#}","下一页"):e.replace("{#page#}","下一页").replace("{#pageValue#}",-1),o.html(b)}var f,g,h=$(a),i=h,j=$(h.attr("data-select-person-trigger")),k=h.attr("data-select-person-oncompleted"),l=h.find(".sec-list-selected"),m=h.find(".sec-list"),n=h.find("form"),o=h.find(".pagination"),p=h.find(".sec-pagination-input"),q=h.find(".select-person-confirm"),r={},s={},t=[],u=n.attr("action");j.on("click",function(){return f=1,p.val(f),s=$.extend({},r),d(),i.modal(),c(),!1}),l.on("click","button",function(){var a=$(this),b=a.data("data");a.remove(),s[b.id]=null,m.find('[cid="'+b.id+'"]').removeClass("btn-info").addClass("btn-default")}),m.on("click","button",function(){var a=$(this),b=a.data("data");if(a.hasClass("btn-info")?a.removeClass("btn-info").addClass("btn-default"):a.removeClass("btn-default").addClass("btn-info"),s[b.id])return s[b.id]=null,l.find('[cid="'+b.id+'"]').remove(),void 0;s[b.id]=b;var c=$('<button type="button" class="btn btn-primary col-md-4" cid="'+b.id+'">'+b.name+"</button>");c.data("data",b),l.append(c)}),n.on("submit",function(){return c(),!1}),n.find('[type="submit"]').on("click",function(){f=1,p.val(f)}),q.on("click",function(){var a=[];l.children().each(function(){var b=$(this).data("data");a.push(b)}),h.modal("hide"),r=$.extend({},s),t=[].concat(a),window[k]({selected:a})}),o.on("click","a",function(){var a=parseInt($(this).attr("value"));0==a?f--:-1==a?f++:f=a,p.val(f),n.submit()})}}}(),function(){var a=function(a){this.init(a)};window.widget.send_sms=a,a.prototype={init:function(a){var b=$(a),c=b.find(".city select"),d=b.find(".area td div"),e=b.attr("data-send-sms-checkbox-name"),f=b.attr("data-send-sms-on-select-change");f&&(f=window[f]);var g=b.attr("data-send-sms-checkbox-validate-text");c.on("change",function(){var a=c.val();if(!a)return d.html(""),void 0;d.html("加载中...");var b={};b.selectId=c.val(),b.build=function(a){for(var b="",c=a,f=0,h=c.length;h>f;f++)0!=f?(b+='<div class="col-md-3"><label class="checkbox-inline">',b+='<input type="checkbox" class="w-check-all-1" value="'+c[f].id+'" name="'+e+'">'+c[f].name,b+="</label></div>"):(b+='<label class="checkbox-inline">',b+='<input type="checkbox" widget="check-all" data-required="true" data-error-container="#sendSmsCheckboxTip" data-required-message="'+g+'" data-check-all-target=".w-check-all-1" value="'+c[f].id+'" name="'+e+'">'+c[f].name,b+='<span class="error" id="sendSmsCheckboxTip"></span>',b+="</label>",b+='<div class="row">');b+="</div>",d.html(b),window.util.parse(d)},f(b)})}}}();